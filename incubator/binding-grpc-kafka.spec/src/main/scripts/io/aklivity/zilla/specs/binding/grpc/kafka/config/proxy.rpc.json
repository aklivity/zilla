{
  "name": "test",
  "guards":
  {
    "test0":
    {
      "type": "test",
      "options":
      {
        "roles": [ "write:items" ]
      }
    }
  },
  "bindings":
  {
    "grpc0":
    {
      "type" : "grpc-kafka",
      "kind": "proxy",
      "routes":
      [
        {
          "guarded":
          {
            "test0": [ "write:items" ]
          },
          "exit": "kafka0",
          "when":
          [
            {
              "service": "example.EchoService",
              "method": "EchoUnary",
              "metadata":
              {
                "custom": "test"
              }
            },
            {
              "service": "example.EchoService",
              "method": "EchoClientStream",
              "metadata":
              {
                "custom": "test"
              }
            },
            {
              "service": "example.EchoService",
              "method": "EchoServerStream",
              "metadata":
              {
                "custom": "test"
              }
            },
            {
              "service": "example.EchoService",
              "method": "EchoStream",
              "metadata":
              {
                "custom": "test"
              }
            }
          ],
          "with":
          {
            "topic": "items",
            "acks": "leader_only",
            "key": "test",
            "overrides":
            {
              "zilla:identity": "${guarded['test0'].identity}"
            },
            "reply-to": "items-replies",
            "filters":
            [
              {
                "headers":
                {
                  "zilla:identity": "${guarded['test0'].identity}"
                }
              }
            ]
          }
        }
      ]
    }
  }
}
