---
name: "example"
bindings:
  tcp_server0:
    type: "tcp"
    kind: "server"
    options:
      host: "0.0.0.0"
      port: 9090
    routes:
    - exit: "tls_server0"
  tcp_server1:
    type: "tcp"
    kind: "server"
    options:
      host: "0.0.0.0"
      port: 8080
    routes:
    - exit: "http_server0"
  tls_server0:
    vault: "server"
    type: "tls"
    kind: "server"
    options:
      keys:
      - "localhost"
      sni:
      - "localhost"
      alpn:
      - "h2"
    routes:
    - exit: "http_server0"
  httpServer0:
    type: "http"
    kind: "server"
    options:
      access-control:
        policy: "cross-origin"
      authorization:
        jwt0:
          credentials:
            headers:
              authorization: "Bearer {credentials}"
  http_client0:
    type: "http"
    kind: "client"
    routes:
    - exit: "tls_client0"
  tls_client0:
    vault: "client"
    type: "tls"
    kind: "client"
    options:
      trust:
      - "nginx"
      trustcacerts: true
      sni:
      - "nginx"
      alpn:
      - "h2"
    routes:
    - exit: "tcp_client0"
  tcp_client0:
    type: "tcp"
    kind: "client"
    options:
      host: "nginx"
      port: 443
guards:
  jwt0:
    type: "jwt"
    options:
      issuer: "https://auth.example.com"
      audience: "https://api.example.com"
      keys:
      - kty: "RSA"
        "n": "qqEu50hX+43Bx4W1UYWnAVKwFm+vDbP0kuIOSLVNa+HKQdHTf+3Sei5UCnkskn796izA29D0DdCy3ET9oaKRHIJyKbqFl0rv6f516QzOoXKC6N01sXBHBE/ovs0wwDvlaW+gFGPgkzdcfUlyrWLDnLV7LcuQymhTND2uH0oR3wJnNENN/OFgM1KGPPDOe19YsIKdLqARgxrhZVsh06OurEviZTXOBFI5r+yac7haDwOQhLHXNv+Y9MNvxs5QLWPFIM3bNUWfYrJnLrs4hGJS+y/KDM9Si+HL30QAFXy4YNO33J8DHjZ7ddG5n8/FqplOKvRtUgjcKWlxoGY4VdVaDQ=="
        e: "AQAB"
        alg: "RS256"
        kid: "example"
vaults:
  client:
    type: "filesystem"
    options:
      trust:
        store: "tls/truststore.p12"
        type: "pkcs12"
        password: "${{env.KEYSTORE_PASSWORD}}"
  server:
    type: "filesystem"
    options:
      trust:
        store: "tls/truststore.p12"
        type: "pkcs12"
        password: "${{env.KEYSTORE_PASSWORD}}"
