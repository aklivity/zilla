{
    "name": "example",
    "vaults":
    {
        "server":
        {
            "type": "filesystem",
            "options":
            {
                "keys":
                {
                    "store": "localhost.p12",
                    "type": "pkcs12",
                    "password": "generated"
                }
            }
        }
    },
    "bindings":
    {
        "tcp0":
        {
            "type" : "tcp",
            "kind": "server",
            "options":
            {
                "host": "0.0.0.0",
                "port": 9090
            },
            "exit": "tls0"
        },
        "tcp1":
        {
            "type" : "tcp",
            "kind": "server",
            "options":
            {
                "host": "0.0.0.0",
                "port": 8080
            },
            "exit": "http0"
        },
        "tls0":
        {
            "type" : "tls",
            "kind": "server",
            "vault": "server",
            "options":
            {
                "keys": [ "localhost" ],
                "sni": [ "localhost" ],
                "alpn": [ "http/1.1", "h2" ]
            },
            "exit": "http0"
        },
        "http0":
        {
            "type" : "http",
            "kind": "server",
            "options":
            {
                "access-control":
                {
                    "policy": "cross-origin"
                }
            },
            "routes":
            [
                {
                    "exit": "http_filesystem0",
                    "when":
                    [
                        {
                            "headers":
                            {
                                ":scheme": "http",
                                ":authority": "localhost:8080",
                                ":path": "/index.html"
                            }
                        },
                        {
                            "headers":
                            {
                                ":scheme": "https",
                                ":authority": "localhost:9090",
                                ":path": "/index.html"
                            }
                        }
                    ]
                },
                {
                    "exit": "sse0",
                    "when":
                    [
                        {
                            "headers":
                            {
                                ":scheme": "http",
                                ":authority": "localhost:8080"
                            }
                        },
                        {
                            "headers":
                            {
                                ":scheme": "https",
                                ":authority": "localhost:9090"
                            }
                        }
                    ]
                }
            ]
        },
        "http_filesystem0":
        {
            "type" : "http-filesystem",
            "kind": "proxy",
            "routes":
            [
                {
                    "exit": "filesystem0",
                    "when":
                    [
                        {
                            "path": "/{path}"
                        }
                    ],
                    "with":
                    {
                        "path": "${params.path}"
                    }
                }
            ]
        },
        "filesystem0":
        {
            "type" : "filesystem",
            "kind": "server",
            "options":
            {
                "location": "web/"
            }
        },
        "sse0":
        {
            "type" : "sse",
            "kind": "server",
            "exit": "sse_kafka0"
        },
        "sse_kafka0":
        {
            "type" : "sse-kafka",
            "kind": "proxy",
            "routes":
            [
                {
                    "exit": "kafka0",
                    "when":
                    [
                        {
                            "path": "/{topic}"
                        }
                    ],
                    "with":
                    {
                        "topic": "${params.topic}"
                    }
                }
            ]
        },
        "kafka0":
        {
            "type" : "kafka",
            "kind": "cache_client",
            "options":
            {
                "merged":
                [
                    "zilla"
                ]
            },
            "exit": "kafka1"
        },
        "kafka1":
        {
            "type" : "kafka",
            "kind": "cache_server",
            "exit": "kafka2"
        },
        "kafka2":
        {
            "type" : "kafka",
            "kind": "client",
            "exit": "tcp2"
        },
        "tcp2":
        {
            "type" : "tcp",
            "kind": "client",
            "options":
            {
                "host": "kafka.internal.net",
                "port": 9092
            },
            "routes":
            [
                {
                    "exit": "net0",
                    "when":
                    [
                        {
                            "cidr": "0.0.0.0/0"
                        }
                    ]
                }
            ],
            "exit": "net0"
        }
    }
}
