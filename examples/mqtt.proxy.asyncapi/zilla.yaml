---
name: zilla-mqtt-kafka-broker
catalogs:
  catalog0:
    type: inline
    options:
      subjects:
        smartylighting:
          schema: |
            asyncapi: 3.0.0
            info:
              title: Zilla MQTT Proxy
              version: 1.0.0
              license:
                name: Aklivity Community License
            servers:
              plain:
                host: localhost:7183
                protocol: mqtt
            defaultContentType: application/json
            
            channels:
              smartylighting:
                address: "smartylighting/streetlights/1/0/event/1/lighting/measured"
                title: MQTT Topic to produce & consume topic.
                messages:
                  item:
                    $ref: '#/components/messages/item'
            
            operations:
              sendEvents:
                action: send
                channel:
                  $ref: '#/channels/smartylighting'
            
              receiveEvents:
                action: receive
                channel:
                  $ref: '#/channels/smartylighting'
            
            components:
              messages:
                item:
                  name: event
                  title: An event
                  headers:
                    type: object
                    properties:
                      idempotency-key:
                        description: Unique identifier for a given event
                        type: string
                      id:
                        description: Street Light ID
                        type: string
                  contentType: application/json
                  payload:
                    type: object
                    properties:
                      item:
                        $ref: "#/components/schemas/item"
              schemas:
                item:
                  type: object
                  properties:
                    id:
                      type: string
                    status:
                      type: string
                  required:
                    - id
                    - status
bindings:
  asyncapi_server:
    type: asyncapi
    kind: server
    options:
      specs:
        my-asyncapi-spec:
          catalog:
            catalog0:
              subject: smartylighting
              version: latest
    exit: asyncapi_client
  asyncapi_client:
    type: asyncapi
    kind: client
    options:
      specs:
        my-asyncapi-spec:
          catalog:
            catalog0:
              subject: smartylighting
              version: latest
      tcp:
        host: ${{env.MOSQUITTO_BROKER_HOST}}
        port: ${{env.MOSQUITTO_BROKER_PORT}}
